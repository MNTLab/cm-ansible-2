---
# tasks file for jenkins
- debug: msg="Will install Jenkins"

- name: install git
  yum: name=git

- name: get jenkins repo
  get_url: url=http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo dest=/etc/yum.repos.d/jenkins.repo

- name: import key
  rpm_key: key=https://jenkins-ci.org/redhat/jenkins-ci.org.key validate_certs=False

- name: install
  yum: name=jenkins state=latest

- name: place jenkins config
  template: src=jenkins.j2 dest=/etc/sysconfig/jenkins

- name: install plugins
  get_url:
    url: localhost:8082/jenkins/jnlpJars/jenkins-cli.jar
    dest: /tmp/jenkins-cli.jar

- name: plugin1 
  command: java -jar /tmp/jenkins-cli.jar -s http://localhost:8082/jenkins install-plugin git

- name: plugin2
  command: java -jar /tmp/jenkins-cli.jar -s http://localhost:8082/jenkins install-plugin maven-plugin

- name: plugin3
  command: java -jar /tmp/jenkins-cli.jar -s http://localhost:8082/jenkins install-plugin delivery-pipeline-plugin

- name: plugin4
  command: java -jar /tmp/jenkins-cli.jar -s http://localhost:8082/jenkins install-plugin copyartifact

- name: install maven for jenkins
  copy: src=hudson.tasks.Maven.xml dest=/var/lib/jenkins/ force=no

- name: jobs
  copy: src=jobs dest=/var/lib/jenkins/ force=no

- name: check ownership
  file: 
    path: /var/lib/jenkins
    owner: jenkins
    group: jenkins
    recurse: yes

- name: start jenkins
  service:
    name: jenkins
    state: started

